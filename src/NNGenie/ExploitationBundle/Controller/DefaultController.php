<?php

namespace NNGenie\ExploitationBundle\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\Controller;

class DefaultController extends Controller
{
    public function indexAction()
    {
        if (!$this->get('security.context')->isGranted('IS_AUTHENTICATED_REMEMBERED')) {
            return $this->redirect($this->generateUrl('fos_user_security_login'));
        }
        $repositoryPersonnel = $this->getDoctrine()->getManager()->getRepository("NNGenieExploitationBundle:Personnel");
        $userManager = $this->container->get('fos_user.user_manager');
        $repositoryEmployeur = $this->getDoctrine()->getManager()->getRepository("NNGenieExploitationBundle:Employeur");
        $repositoryQualification = $this->getDoctrine()->getManager()->getRepository("NNGenieExploitationBundle:Qualification");
        $personnel = $repositoryPersonnel->findBy(array("statut" => 1));
        $users = $userManager->findUsers();
        $employeur = $repositoryEmployeur->findBy(array("statut" => 1));
        $qualification = $repositoryQualification->findBy(array("statut" => 1));

        //return $this->render('NNGenieInfosMatBundle::index.html.twig', array("materiels"=> $materiels));
        return $this->render('NNGenieExploitationBundle:Accueil:index.html.twig', array('nombreUsers' => count($users), 'nombrePersonnels' => count($personnel), 'nombreEmployeurs' => count($employeur), 'nombreQualifications' => count($qualification)));
    }
}
